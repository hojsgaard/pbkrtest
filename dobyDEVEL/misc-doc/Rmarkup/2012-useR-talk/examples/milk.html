<h1>Analysis of NIR data </h1>
<!--begin{Schunk}!--> 

<p class='character'><tt> [1]&nbsp;"2012-06-14&nbsp;22:26:17" </tt></p>

<!--end{Schunk}!-->
<br>
NIR measurements are made at 152 wavelengths on 17 milk
samples. Milk runs trough a glass tube. <span style="font-weight: bold;">Near infra red</span> 
light is sent through the
tube and the the amount of light that goes through the milk at
different wavelengths is recorded. The milk is analyzed for contents
of <span style="text-decoration: underline;">fat</span>, <span style="text-decoration: underline;">lactose</span>, <span style="text-decoration: underline;">protein</span> and <span style="text-decoration: underline;">drymatter</span>.
<br><br>
The question is whether <span style="text-decoration: underline;">fat</span>,<span style="text-decoration: underline;">lactose</span>, <span style="text-decoration: underline;">protein</span> and
<span style="text-decoration: underline;">drymatter</span> can be predicted from the NIR measurements.
<br>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><PRE>&gt data(NIRmilk, package = "doBy")</pre></p>



<p><PRE>&gt dim(NIRmilk)</pre></p>


<!--end{Sinput}!-->

<p class='character'><tt> [1]&nbsp;&nbsp;17&nbsp;158 </tt></p>
<!-- begin{Sinput} !-->

<p><PRE>&gt head(round(NIRmilk[, c(1:6, 152:158)], 3))</pre></p>


<!--end{Sinput}!-->

<p class='character'><tt> &nbsp;&nbsp;sample&nbsp;&nbsp;X964&nbsp;&nbsp;X968&nbsp;&nbsp;X972&nbsp;&nbsp;X976&nbsp;&nbsp;X979&nbsp;X1542&nbsp;X1546&nbsp;&nbsp;X1550&nbsp;&nbsp;&nbsp;fat&nbsp;protein&nbsp;lactose </tt>
<br>
<tt> 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;0.054&nbsp;0.056&nbsp;0.061&nbsp;0.078&nbsp;0.109&nbsp;0.034&nbsp;0.012&nbsp;-0.008&nbsp;4.168&nbsp;&nbsp;&nbsp;3.639&nbsp;&nbsp;&nbsp;4.530 </tt>
<br>
<tt> 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;0.069&nbsp;0.071&nbsp;0.078&nbsp;0.098&nbsp;0.135&nbsp;0.022&nbsp;0.000&nbsp;-0.020&nbsp;4.227&nbsp;&nbsp;&nbsp;3.549&nbsp;&nbsp;&nbsp;5.564 </tt>
<br>
<tt> 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;0.068&nbsp;0.070&nbsp;0.077&nbsp;0.099&nbsp;0.136&nbsp;0.059&nbsp;0.033&nbsp;&nbsp;0.010&nbsp;3.904&nbsp;&nbsp;&nbsp;4.299&nbsp;&nbsp;&nbsp;5.490 </tt>
<br>
<tt> 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;0.055&nbsp;0.057&nbsp;0.062&nbsp;0.080&nbsp;0.110&nbsp;0.108&nbsp;0.082&nbsp;&nbsp;0.060&nbsp;3.162&nbsp;&nbsp;&nbsp;4.547&nbsp;&nbsp;&nbsp;4.356 </tt>
<br>
<tt> 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;0.075&nbsp;0.077&nbsp;0.082&nbsp;0.101&nbsp;0.135&nbsp;0.101&nbsp;0.080&nbsp;&nbsp;0.061&nbsp;2.144&nbsp;&nbsp;&nbsp;4.108&nbsp;&nbsp;&nbsp;5.104 </tt>
<br>
<tt> 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;0.069&nbsp;0.071&nbsp;0.077&nbsp;0.099&nbsp;0.136&nbsp;0.037&nbsp;0.015&nbsp;-0.004&nbsp;4.352&nbsp;&nbsp;&nbsp;3.413&nbsp;&nbsp;&nbsp;5.626 </tt>
<br>
<tt> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dm </tt>
<br>
<tt> 1&nbsp;13.067 </tt>
<br>
<tt> 2&nbsp;14.063 </tt>
<br>
<tt> 3&nbsp;14.470 </tt>
<br>
<tt> 4&nbsp;12.893 </tt>
<br>
<tt> 5&nbsp;12.127 </tt>
<br>
<tt> 6&nbsp;14.177 </tt></p>

<!--end{Schunk}!-->
<br>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><PRE>&gt nir <- NIRmilk[, 2:153]</pre></p>



<p><PRE>&gt waveLength <- gsub("\\.", "", (gsub("X", "", names(nir))))</pre></p>



<p><PRE>&gt matplot(waveLength, t(nir), type = "l", xlab = "wavelength")</pre></p>


<!--end{Sinput}!-->

<!--end{Schunk}!-->
<p align= left ><img height=500 width=500 src='milk-003.png'></p><br>
<br>
More variation in data is revealed if data is centered around the mean
of each column
<br>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><PRE>&gt nircent <- scale(nir, center = TRUE, scale = FALSE)</pre></p>



<p><PRE>&gt matplot(waveLength, t(nircent), type = "l", xlab = "wavelength")</pre></p>


<!--end{Sinput}!-->

<!--end{Schunk}!-->
<p align= left ><img height=500 width=500 src='milk-004.png'></p><br>
We make a PCA on the centered data:
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><PRE>&gt PCA <- prcomp(nircent)</pre></p>



<p><PRE>&gt summary(PCA)</pre></p>


<!--end{Sinput}!-->

<p class='character'><tt> Importance&nbsp;of&nbsp;components: </tt>
<br>
<tt> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC1&nbsp;&nbsp;&nbsp;&nbsp;PC2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC7 </tt>
<br>
<tt> Standard&nbsp;deviation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.1575&nbsp;0.1202&nbsp;0.09539&nbsp;0.02046&nbsp;0.004769&nbsp;0.003699&nbsp;0.002117 </tt>
<br>
<tt> Proportion&nbsp;of&nbsp;Variance&nbsp;0.5081&nbsp;0.2959&nbsp;0.18641&nbsp;0.00858&nbsp;0.000470&nbsp;0.000280&nbsp;0.000090 </tt>
<br>
<tt> Cumulative&nbsp;Proportion&nbsp;&nbsp;0.5081&nbsp;0.8040&nbsp;0.99043&nbsp;0.99900&nbsp;0.999470&nbsp;0.999750&nbsp;0.999840 </tt>
<br>
<tt> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC13 </tt>
<br>
<tt> Standard&nbsp;deviation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00174&nbsp;0.001176&nbsp;0.001104&nbsp;0.0008254&nbsp;0.0007399&nbsp;0.0005534 </tt>
<br>
<tt> Proportion&nbsp;of&nbsp;Variance&nbsp;0.00006&nbsp;0.000030&nbsp;0.000020&nbsp;0.0000100&nbsp;0.0000100&nbsp;0.0000100 </tt>
<br>
<tt> Cumulative&nbsp;Proportion&nbsp;&nbsp;0.99990&nbsp;0.999930&nbsp;0.999960&nbsp;0.9999700&nbsp;0.9999800&nbsp;0.9999900 </tt>
<br>
<tt> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC17 </tt>
<br>
<tt> Standard&nbsp;deviation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0005226&nbsp;0.0004632&nbsp;0.0004033&nbsp;1.092e-17 </tt>
<br>
<tt> Proportion&nbsp;of&nbsp;Variance&nbsp;0.0000100&nbsp;0.0000000&nbsp;0.0000000&nbsp;0.000e+00 </tt>
<br>
<tt> Cumulative&nbsp;Proportion&nbsp;&nbsp;0.9999900&nbsp;1.0000000&nbsp;1.0000000&nbsp;1.000e+00 </tt></p>

<!--end{Schunk}!-->
<br>
Hence, 80 % of the total variation in a 150--dimensional data set is
explained by the first two principal components and practically all
variation is explained by the first three principal components. This
is quite a substantial reduction in dimension.
<br><br>
We can display the loadings as
<br>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><PRE>&gt matplot(waveLength, PCA$rot[, 1:3], type = "l", col = 1:3, lty = 1, </pre></p>

<p><PRE>&gt     ylim = c(-0.22, 0.22))</pre></p>



<p><PRE>&gt abline(h = 0)</pre></p>



<p><PRE>&gt library(gplots)</pre></p>



<p><PRE>&gt smartlegend("center", "bottom", legend = c("PC1", "PC2", "PC3"), </pre></p>

<p><PRE>&gt     col = c(1:3), lty = c(1, 1, 1))</pre></p>


<!--end{Sinput}!-->

<!--end{Schunk}!-->
<p align= left ><img height=500 width=500 src='milk-006.png'></p><br>
So - the loadings for <span style="text-decoration: underline;">PC1</span> (black line) come mainly from the low
wavelengths; loadings for <span style="text-decoration: underline;">PC2</span> (red line) come mainly from high
wavelengths loadings for <span style="text-decoration: underline;">PC3</span> come from, more localized regions of
wavelengths. Finally the intermediate wavelengths seem to contribute
only slightly to all three components. 
<br>
<h2>PCR: Principal component regression </h2>
<br>
Principal component regression is very straight forward:
<OL>
<LI> First derive principal components of the explanatory variables and 
<LI> Then use these principal components as explanatory variables.
</OL>
<br>
Let us combine the first three principal components with the responses:
<br>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><PRE>&gt nirnew <- cbind(PCA$x[, 1:3], NIRmilk[, 155:158])</pre></p>



<p><PRE>&gt head(nirnew)</pre></p>


<!--end{Sinput}!-->

<p class='character'><tt> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PC3&nbsp;&nbsp;&nbsp;&nbsp;fat&nbsp;protein&nbsp;lactose&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dm </tt>
<br>
<tt> 1&nbsp;-0.11594522&nbsp;-0.17025096&nbsp;-0.004671534&nbsp;4.1683&nbsp;&nbsp;3.6390&nbsp;&nbsp;4.5300&nbsp;13.0667 </tt>
<br>
<tt> 2&nbsp;&nbsp;0.17489004&nbsp;-0.11226120&nbsp;-0.084292848&nbsp;4.2273&nbsp;&nbsp;3.5490&nbsp;&nbsp;5.5643&nbsp;14.0633 </tt>
<br>
<tt> 3&nbsp;&nbsp;0.13820007&nbsp;&nbsp;0.11101555&nbsp;-0.047871832&nbsp;3.9040&nbsp;&nbsp;4.2993&nbsp;&nbsp;5.4897&nbsp;14.4700 </tt>
<br>
<tt> 4&nbsp;-0.22655731&nbsp;&nbsp;0.17527552&nbsp;&nbsp;0.033194764&nbsp;3.1617&nbsp;&nbsp;4.5467&nbsp;&nbsp;4.3560&nbsp;12.8933 </tt>
<br>
<tt> 5&nbsp;-0.05103537&nbsp;&nbsp;0.17342919&nbsp;-0.099546952&nbsp;2.1443&nbsp;&nbsp;4.1083&nbsp;&nbsp;5.1037&nbsp;12.1267 </tt>
<br>
<tt> 6&nbsp;&nbsp;0.21445607&nbsp;-0.08096041&nbsp;-0.080089550&nbsp;4.3520&nbsp;&nbsp;3.4133&nbsp;&nbsp;5.6257&nbsp;14.1767 </tt></p>
<!-- begin{Sinput} !-->

<p><PRE>&gt pairs(nirnew)</pre></p>


<!--end{Sinput}!-->

<!--end{Schunk}!-->
<p align= left ><img height=500 width=500 src='milk-007.png'></p><br>
Now, we can try to make a multiple regression explaining <span style="text-decoration: underline;">fat</span> not
directly in terms of the wavelengths but in terms of the principal
components: 
<br>
<!-- begin{Schunk} !-->
<!-- begin{Sinput} !-->

<p><PRE>&gt m1 <- lm(fat ~ PC1 + PC2 + PC3, data = nirnew)</pre></p>



<p><PRE>&gt summary(m1)</pre></p>


<!--end{Sinput}!-->

<p class='character'><tt>  </tt>
<br>
<tt> Call: </tt>
<br>
<tt> lm(formula&nbsp;=&nbsp;fat&nbsp;~&nbsp;PC1&nbsp;+&nbsp;PC2&nbsp;+&nbsp;PC3,&nbsp;data&nbsp;=&nbsp;nirnew) </tt>
<br>
<tt>  </tt>
<br>
<tt> Residuals: </tt>
<br>
<tt> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Min&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1Q&nbsp;&nbsp;&nbsp;&nbsp;Median&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3Q&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Max&nbsp; </tt>
<br>
<tt> -0.084584&nbsp;-0.026316&nbsp;-0.006242&nbsp;&nbsp;0.034143&nbsp;&nbsp;0.061544&nbsp; </tt>
<br>
<tt>  </tt>
<br>
<tt> Coefficients: </tt>
<br>
<tt> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Estimate&nbsp;Std.&nbsp;Error&nbsp;t&nbsp;value&nbsp;Pr(>|t|)&nbsp;&nbsp;&nbsp;&nbsp; </tt>
<br>
<tt> (Intercept)&nbsp;&nbsp;4.24592&nbsp;&nbsp;&nbsp;&nbsp;0.01111&nbsp;&nbsp;382.05&nbsp;&nbsp;<&nbsp;2e-16&nbsp;*** </tt>
<br>
<tt> PC1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.32000&nbsp;&nbsp;&nbsp;&nbsp;0.07274&nbsp;&nbsp;&nbsp;59.39&nbsp;&nbsp;<&nbsp;2e-16&nbsp;*** </tt>
<br>
<tt> PC2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-3.07567&nbsp;&nbsp;&nbsp;&nbsp;0.09532&nbsp;&nbsp;-32.27&nbsp;8.53e-14&nbsp;*** </tt>
<br>
<tt> PC3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13.27432&nbsp;&nbsp;&nbsp;&nbsp;0.12009&nbsp;&nbsp;110.54&nbsp;&nbsp;<&nbsp;2e-16&nbsp;*** </tt>
<br>
<tt> --- </tt>
<br>
<tt> Signif.&nbsp;codes:&nbsp;&nbsp;0&nbsp;‘***’&nbsp;0.001&nbsp;‘**’&nbsp;0.01&nbsp;‘*’&nbsp;0.05&nbsp;‘.’&nbsp;0.1&nbsp;‘&nbsp;’&nbsp;1&nbsp; </tt>
<br>
<tt>  </tt>
<br>
<tt> Residual&nbsp;standard&nbsp;error:&nbsp;0.04582&nbsp;on&nbsp;13&nbsp;degrees&nbsp;of&nbsp;freedom </tt>
<br>
<tt> Multiple&nbsp;R-squared:&nbsp;0.9992,	Adjusted&nbsp;R-squared:&nbsp;0.999&nbsp; </tt>
<br>
<tt> F-statistic:&nbsp;&nbsp;5596&nbsp;on&nbsp;3&nbsp;and&nbsp;13&nbsp;DF,&nbsp;&nbsp;p-value:&nbsp;<&nbsp;2.2e-16&nbsp; </tt>
<br>
<tt>  </tt></p>

<!--end{Schunk}!-->
<br>
<br>
<br>
